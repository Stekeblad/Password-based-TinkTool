# Password-based Tink Tool

A simple password-based commandline tool for creating
[Google Tink cryptographic keys](https://github.com/google/tink) and
using them to create and verify digital signatures. This is also an
example of how Google Tink can be used in Java.

Current features:
- Generate new password-protected keys
- Create a signature using one of the generated keys
- Verify that a signature was created for a file and with a specific key


### Stekeblad is not a security specialist and there may be security flaws in the code. Stekeblad takes no responsibility for any problems you may get from using this tool.

Pull request with security and code improvements are welcome

## Background

When I created a updating feature to my
[video uploader project](https://github.com/Stekeblad/Stekeblads-Video-Uploader)
I wanted to add some security to the updating procedure by signing the
updates and check the signature in the program before applying any
updates. My choice on crypto library fell on Google Tink. But before
verifying a signature I need to create one and this was the start of
this project.

Google have their tool
[Tinkey](https://github.com/google/tink/blob/master/docs/TINKEY.md).
Tinkey is built around saving the keys in a remote key store but I
wanted something where my private key is stored securely on my computer.

## How it works

This section answers the following questions:
- How does this tool verify that a password is correct without saving it
  in plaintext somewhere?
- What type of keys are used?
- How are the private keys protected?

When you create a new key and enter your password it is hashed using
[Argon2](https://en.wikipedia.org/wiki/Argon2). A Argon2 hash is made up
by more than just the hash value, it also contains information about the
parameters used by the hash function and the salt used on the input.
When new keys are created a random salt is generated by Argon2.

The first 32 bytes (256 bits) of the actual hash value is extracted and
used to create a AEAD key. This key will always look the same if you
give it the same input bytes and is used to encrypt and decrypt the
actual private key.

Next is a new ECDSA_P256 key pair created that can be used for creating
and verifying signatures. No other parameters other than the key type is
given to the key generation method. Now can the private key be encrypted
with the key derived from the password and saved to disk, the public key
is not secret and saved to disk directly.

The last thing to do is to make sure the encryption/decryption key can
be re-created to decrypt the private key for signing later. The password
is the user's secret and can not be saved, nor can the full Argon2 hash
be saved as parts of it is used to create the key. It is the salt that
is extracted from the hash and saved, it works because Argon2 allow us
to set the salt to use when hashing. By setting the salt the same hash
is created every time for the same password and only if the entered
password is correct is a key capable of decrypting the private key
created.

The public key, private key and salt is currently saved to files in the
directory the program is run from (not the directory of the jar).

## How to use it

By running the tool with no arguments you get a list of available
operations. By only giving the name of a operation as parameters you get
the list of arguments it expects

Assuming the tool is built to a jar with the name TinkTool.jar

#### Create a new key pair
```
java -jar TinkTool.jar new-key myFirstKey
> Pick a password:
> Repeat to verify:
```
myfirstKey is the name you want to give your key. This creates the files
myfirstKey (the private key), myfirstKey.pub (the public key) and
myfirstKey.salt (the salt used for hashing your password)

#### Sign a file
```
java -jar TinkTool.jar sign myFirstKey sign/this/please.txt
> Enter your password:
```
myFirstKey is the name of one of your keys you created.
sign/this/please.txt is the location of the file you want to sign. The
signature is base64-encoded and saved to the same location as the signed
file with ".sig" appended to the file name.

#### Verifying a signature
```
java -jar TinkTool.jar checkSign myFirstKey sign/this/please.txt sign/this/please.txt.sig
```
myFirstKey is the name of one of your keys you created.
sign/this/please.txt is the location of the file you want to sign.
sign/this/please.txt.sig is the signature encoded in base64. You do not
needed to enter the password because the public key is used to verify
signatures, not the private key.
